import{g as e,d as t}from"./index-424d1c5b.js";import{m as a,e as r,a as l,r as o,Z as n,ap as s,E as i,i as u,k as d,n as c,aq as m,j as p,D as f}from"./index-bca2565b.js";const g={default:({row:e,column:t})=>{const r=e[t.field];return[a("span",{class:`el-tag el-tag--${"admin"===r?"":"warning"} el-tag--plain`},[r])]}},v={default:({row:e,column:t})=>{const r=e[t.field],[l,o]=r?["success","启用"]:["danger","禁用"];return[a("span",{class:`el-tag el-tag--${l} el-tag--plain`},[o])]}},h={class:"app-container"},w=r({name:"VxeTable",__name:"index",setup(r){const w=l(),x=o({loading:!0,autoResize:!0,pagerConfig:{align:"right"},formConfig:{items:[{field:"username",itemRender:{name:"$input",props:{placeholder:"用户名",clearable:!0}}},{field:"phone",itemRender:{name:"$input",props:{placeholder:"手机号",clearable:!0}}},{itemRender:{name:"$buttons",children:[{props:{type:"submit",content:"查询",status:"primary"}},{props:{type:"reset",content:"重置"}}]}}]},toolbarConfig:{refresh:!0,custom:!0,slots:{buttons:"toolbar-btns"}},customConfig:{checkMethod:({column:e})=>!["username"].includes(e.field)},columns:[{type:"checkbox",width:"50px"},{field:"username",title:"用户名"},{field:"roles",title:"角色",slots:g},{field:"phone",title:"手机号"},{field:"email",title:"邮箱"},{field:"status",title:"状态",slots:v},{field:"createTime",title:"创建时间"},{title:"操作",width:"150px",fixed:"right",showOverflow:!1,slots:{default:"row-operate"}}],proxyConfig:{seq:!0,form:!0,props:{total:"total"},ajax:{query:({page:t,form:a})=>(x.loading=!0,P.clearTable(),new Promise((r=>{let l=0,o=[];const n=e=>{(null==e?void 0:e.data)&&(l=e.data.total,o=e.data.list),x.loading=!1,r({total:l,result:o})},s={username:a.username||void 0,phone:a.phone||void 0,size:t.pageSize,currentPage:t.currentPage};e(s).then(n).catch(n)})))}}}),y=l(),b=o({title:"",showClose:!0,escClosable:!0,maskClosable:!0,beforeHideMethod:()=>{var e;return null==(e=k.value)||e.clearValidate(),Promise.resolve()}}),k=l(),C=o({span:24,titleWidth:"100px",loading:!1,titleColon:!1,data:{username:"",password:""},items:[{field:"username",title:"用户名",itemRender:{name:"$input",props:{placeholder:"请输入"}}},{field:"password",title:"密码",itemRender:{name:"$input",props:{placeholder:"请输入"}}},{align:"right",itemRender:{name:"$buttons",children:[{props:{content:"取消"},events:{click:()=>{var e;return null==(e=y.value)?void 0:e.close()}}},{props:{type:"submit",content:"确定",status:"primary"},events:{click:()=>P.onSubmitForm()}}]}}],rules:{username:[{required:!0,validator:({itemValue:e})=>{switch(!0){case!e:return new Error("请输入");case!e.trim():return new Error("空格无效")}}}],password:[{required:!0,validator:({itemValue:e})=>{switch(!0){case!e:return new Error("请输入");case!e.trim():return new Error("空格无效")}}}]}}),P=o({isUpdate:!0,commitQuery:()=>{var e;return null==(e=w.value)?void 0:e.commitProxy("query")},clearTable:()=>{var e;return null==(e=w.value)?void 0:e.reloadData([])},onShowModal:e=>{var t,a,r,l;e?(P.isUpdate=!0,b.title="修改用户",C.data.username=e.username):(P.isUpdate=!1,b.title="新增用户");const o=null==(r=null==(a=null==(t=C.items)?void 0:t[0])?void 0:a.itemRender)?void 0:r.props;o&&(o.disabled=P.isUpdate),null==(l=y.value)||l.open(),n((()=>{var e,t;!P.isUpdate&&(null==(e=k.value)||e.reset()),null==(t=k.value)||t.clearValidate()}))},onSubmitForm:()=>{var e;C.loading||null==(e=k.value)||e.validate((e=>{if(e)return;C.loading=!0;const t=()=>{var e;C.loading=!1,null==(e=y.value)||e.close(),i.success("操作成功"),!P.isUpdate&&P.afterInsert(),P.commitQuery()};P.isUpdate,setTimeout((()=>t()),1e3)}))},afterInsert:()=>{var e,t;const a=null==(t=null==(e=w.value)?void 0:e.getProxyInfo())?void 0:t.pager;if(a){a.currentPage*a.pageSize===a.total&&++a.currentPage}},onDelete:e=>{const a=`确定 <strong style="color: red"> 删除 </strong> 用户 <strong style="color: #409eff"> ${e.username} </strong> ？`;s.confirm(a,"提示",{type:"warning",showClose:!0,closeOnClickModal:!0,closeOnPressEscape:!0,cancelButtonText:"取消",confirmButtonText:"确定",dangerouslyUseHTMLString:!0}).then((()=>{t(e.id).then((()=>{i.success("删除成功"),P.afterDelete(),P.commitQuery()}))}))},afterDelete:()=>{var e,t;const a=w.value.getData(),r=null==(t=null==(e=w.value)?void 0:e.getProxyInfo())?void 0:t.pager;r&&r.currentPage>1&&1===a.length&&--r.currentPage},moreFn:()=>{}});return(e,t)=>{const r=u("vxe-button"),l=u("el-button"),o=u("vxe-grid"),n=u("vxe-form"),s=u("vxe-modal");return p(),d("div",h,[a(o,m({ref_key:"xGridDom",ref:w},x),{"toolbar-btns":c((()=>[a(r,{status:"primary",icon:"vxe-icon-add",onClick:t[0]||(t[0]=e=>P.onShowModal())},{default:c((()=>[f("新增用户")])),_:1}),a(r,{status:"danger",icon:"vxe-icon-delete"},{default:c((()=>[f("批量删除")])),_:1})])),"row-operate":c((({row:e})=>[a(l,{link:"",type:"primary",onClick:t=>P.onShowModal(e)},{default:c((()=>[f("修改")])),_:2},1032,["onClick"]),a(l,{link:"",type:"danger",onClick:t=>P.onDelete(e)},{default:c((()=>[f("删除")])),_:2},1032,["onClick"])])),_:1},16),a(s,m({ref_key:"xModalDom",ref:y},b),{default:c((()=>[a(n,m({ref_key:"xFormDom",ref:k},C),null,16)])),_:1},16)])}}});export{w as default};

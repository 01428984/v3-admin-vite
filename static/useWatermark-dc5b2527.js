import{n as x}from"./element-4018b73c.js";import{r as W,z as C}from"./vue-2207505e.js";const _={color:"#c0c4cc",opacity:.5,size:16,family:"serif",angle:-20,width:300,height:200},g=W(document.body);function E(i=g){let h,b,r=null;const y=(e,t={})=>{if(!i.value){console.warn("请在 DOM 挂载完成后再调用 setWatermark 方法设置水印");return}h=e,b={..._,...t},m(),f(i.value)},O=()=>{d(),m(),f(i.value)},m=()=>{if(r){v();return}const e=document.createElement("div");e.style.pointerEvents="none",e.style.top="0",e.style.left="0",e.style.position="absolute",e.style.zIndex="99999",r=e;const{clientWidth:t,clientHeight:s}=i.value;v({width:t,height:s}),i.value.style.position="relative",i.value.appendChild(e)},v=(e={})=>{r&&(h&&(r.style.background=`url(${k()}) left top repeat`),e.width&&(r.style.width=`${e.width}px`),e.height&&(r.style.height=`${e.height}px`))},k=()=>{const{color:e,opacity:t,size:s,family:n,angle:o,width:c,height:l}=b,u=document.createElement("canvas");u.width=c,u.height=l;const a=u.getContext("2d");return a&&(a.fillStyle=e,a.globalAlpha=t,a.font=`${s}px ${n}`,a.rotate(Math.PI/180*o),a.fillText(h,0,l/2)),u.toDataURL()},d=()=>{!i.value||!r||(i.value.removeChild(r),r=null,p(i.value))},f=e=>{e._mutationObserver||e._resizeObserver||(w(e),z(e))},p=e=>{var t,s;(t=e._mutationObserver)==null||t.disconnect(),e._mutationObserver=void 0,(s=e._resizeObserver)==null||s.unobserve(e),e._resizeObserver=void 0},w=e=>{const t={attributes:!0,childList:!0,subtree:!0},s=o=>{o.forEach(c=>{switch(c.type){case"childList":c.removedNodes.forEach(l=>{l===r&&e.appendChild(r)});break;case"attributes":O();break}})},n=new MutationObserver(s);n.observe(e,t),e._mutationObserver=n},z=e=>{const t=x(()=>{const{clientWidth:n,clientHeight:o}=e;v({width:n,height:o})},500),s=new ResizeObserver(t);s.observe(e),e._resizeObserver=s};return C(()=>{d()}),{setWatermark:y,clearWatermark:d}}export{E as u};
